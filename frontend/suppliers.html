<!DOCTYPE html>
<html>
  <head>
    <title>Supplier</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3>Suppliers</h3>
      <a href="dashboard.html" class="btn btn-secondary">
        ‚Üê Kembali ke Dashboard
      </a>
    </div>

    <!-- FORM -->
    <div class="card mb-4">
      <div class="card-body">
        <input type="hidden" id="supplier_id" />

        <div class="row">
          <div class="col-md-4">
            <input id="name" class="form-control" placeholder="Supplier Name" />
          </div>

          <div class="col-md-4">
            <input id="email" class="form-control" placeholder="Supplier Email" />
          </div>

          <div class="col-md-4">
            <input id="address" class="form-control" placeholder="Supplier Address" />
          </div>

          <div class="col-md-2">
            <button id="saveSupplier" class="btn btn-primary w-100">Save</button>
          </div>
        </div>
      </div>
    </div>

    <!-- TABLE -->
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Name</th>
          <th>Email</th>
          <th>Address</th>
          <th width="150">Action</th>
        </tr>
      </thead>
      <tbody id="supplierTable"></tbody>
    </table>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="assets/js/app.js"></script>

    <script>
      loadSuppliers();

      function loadSuppliers() {
        apiRequest({
          url: "/supplier",
          success: function (res) {
            let rows = "";
            res.data.forEach((supplier) => {
              rows += `
          <tr>
            <td>${supplier.name}</td>
            <td>${supplier.email}</td>
            <td>${supplier.address}</td>
            <td>
              <button class="btn btn-warning btn-sm edit"
                data-id="${supplier.id}"
                data-name="${supplier.name}"
                data-email="${supplier.email}"
                data-address="${supplier.address}">
                Edit
              </button>
              <button class="btn btn-danger btn-sm delete" data-id="${supplier.id}">
                Delete
              </button>
            </td>
          </tr>
        `;
            });
            $("#supplierTable").html(rows);
          },
        });
      }

      // CREATE & UPDATE
      $("#saveSupplier").click(function () {
        let id = $("#supplier_id").val();
        let method = id ? "PUT" : "POST";
        let url = id ? `/supplier/${id}` : "/supplier";

        apiRequest({
          url,
          method,
          data: {
            name: $("#name").val(),
            email: $("#email").val(),
            address: $("#address").val(),
          },
          success: function () {
            Swal.fire("Success", "Supplier saved", "success");
            resetForm();
            loadSuppliers();
          },
        });
      });

      // EDIT
      $("#supplierTable").on("click", ".edit", function () {
        $("#supplier_id").val($(this).data("id"));
        $("#name").val($(this).data("name"));
        $("#email").val($(this).data("email"));
        $("#address").val($(this).data("address"));
      });

      // DELETE
      $("#supplierTable").on("click", ".delete", function () {
        let id = $(this).data("id");

        Swal.fire({
          title: "Delete?",
          showCancelButton: true,
          confirmButtonText: "Yes",
        }).then((result) => {
          if (result.isConfirmed) {
            apiRequest({
              url: `/supplier/${id}`,
              method: "DELETE",
              success: function () {
                loadSuppliers();
              },
            });
          }
        });
      });

      function resetForm() {
        $("#supplier_id").val("");
        $("#name").val("");
        $("#email").val("");
        $("#address").val("");
      }
    </script>
  </body>
</html>
