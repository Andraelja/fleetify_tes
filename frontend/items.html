<!DOCTYPE html>
<html>
  <head>
    <title>Items</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>
  <body class="container mt-5">
    <div class="d-flex justify-content-between align-items-center mb-3">
      <h3>Items</h3>
      <a href="dashboard.html" class="btn btn-secondary">
        ‚Üê Kembali ke Dashboard
      </a>
    </div>

    <!-- FORM -->
    <div class="card mb-4">
      <div class="card-body">
        <input type="hidden" id="item_id" />

        <div class="row">
          <div class="col-md-4">
            <input id="name" class="form-control" placeholder="Item Name" />
          </div>
          <div class="col-md-3">
            <input
              id="stock"
              type="number"
              class="form-control"
              placeholder="Stock"
            />
          </div>
          <div class="col-md-3">
            <input
              id="price"
              type="number"
              class="form-control"
              placeholder="Price"
            />
          </div>
          <div class="col-md-2">
            <button id="saveItem" class="btn btn-primary w-100">Save</button>
          </div>
        </div>
      </div>
    </div>

    <!-- TABLE -->
    <table class="table table-bordered">
      <thead>
        <tr>
          <th>Name</th>
          <th>Stock</th>
          <th>Price</th>
          <th width="150">Action</th>
        </tr>
      </thead>
      <tbody id="itemTable"></tbody>
    </table>

    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="assets/js/app.js"></script>

    <script>
      loadItems();

      function formatRupiah(number) {
        return new Intl.NumberFormat("id-ID", {
          style: "currency",
          currency: "IDR",
        }).format(number);
      }

      function loadItems() {
        apiRequest({
          url: "/item",
          success: function (res) {
            let rows = "";
            res.data.forEach((item) => {
              rows += `
            <tr>
              <td>${item.name}</td>
              <td>${item.stock}</td>
              <td>${formatRupiah(item.price)}</td>
              <td>
                <button class="btn btn-warning btn-sm edit"
                  data-id="${item.id}"
                  data-name="${item.name}"
                  data-stock="${item.stock}"
                  data-price="${item.price}">
                  Edit
                </button>
                <button class="btn btn-danger btn-sm delete" data-id="${
                  item.id
                }">
                  Delete
                </button>
              </td>
            </tr>
          `;
            });
            $("#itemTable").html(rows);
          },
        });
      }

      // CREATE & UPDATE
      $("#saveItem").click(function () {
        let id = $("#item_id").val();
        let method = id ? "PUT" : "POST";
        let url = id ? `/item/${id}` : "/item";

        apiRequest({
          url,
          method,
          data: {
            name: $("#name").val(),
            stock: parseInt($("#stock").val()),
            price: parseInt($("#price").val()),
          },
          success: function () {
            Swal.fire("Success", "Item saved", "success");
            resetForm();
            loadItems();
          },
        });
      });

      // EDIT
      $("#itemTable").on("click", ".edit", function () {
        $("#item_id").val($(this).data("id"));
        $("#name").val($(this).data("name"));
        $("#stock").val($(this).data("stock"));
        $("#price").val($(this).data("price"));
      });

      // DELETE
      $("#itemTable").on("click", ".delete", function () {
        let id = $(this).data("id");

        Swal.fire({
          title: "Delete?",
          showCancelButton: true,
          confirmButtonText: "Yes",
        }).then((result) => {
          if (result.isConfirmed) {
            apiRequest({
              url: `/item/${id}`,
              method: "DELETE",
              success: function () {
                loadItems();
              },
            });
          }
        });
      });

      function resetForm() {
        $("#item_id").val("");
        $("#name").val("");
        $("#stock").val("");
        $("#price").val("");
      }
    </script>
  </body>
</html>
